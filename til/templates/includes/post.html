
{% load thumbnail %}
{% load post_tags %}
{% load static %}
<script defer src="https://unpkg.com/alpinejs@3.1.1/dist/cdn.min.js"></script>
<style>
	@import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');
	@import url('https://fonts.googleapis.com/css2?family=Varela&display=swap');
	@import url('https://fonts.googleapis.com/css2?family=Karla:wght@200&display=swap');

	* {
		font-family: 'Nunito', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
		direction: ltr;
		font-weight: 500;
	}
</style>

{% include 'includes/background.html' %}

<div class="mx-auto flex justify-center max-w-3xl md:mb-1 mt-1 bg-white rounded-lg items-center relative md:p-0 "
	x-data="{
        comment : false,
    }">

	<div class="h-full relative">
		<div class="py-1 px-2">
			<div class="flex justify-between items-center pt-2">
				<div class="relative mt-1 flex">
					<div class="flex mb-1">
						<a href="{% url 'profiles:detail' post.author.username %}">
							{% thumbnail post.author.profile.image "59x59" crop="center" as im %}
							<img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}"
								class="rounded-full object-scale-down">
							{% endthumbnail %}
						</a>
						<!-- <img class="w-12 h-12 rounded-full" src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"/> -->
						<div class="ml-2 mt-0.5">
							<span
								class="block font-medium text-sm md:text-xl leading-snug text-black dark:text-gray-100 object-scale-down capitalize">{{post.author.username}}</span>
							<span
								class="block text-xs md:text-sm text-gray-500 dark:text-gray-400 font-light leading-snug object-scale-down"">{{post.date_time}}</span>
            			</div>
          			</div>
				
						<!-- <span class=" text-xs mx-2">â€¢</span>
							<button
								class="text-indigo-500 text-sm capitalize flex justify-start items-start">follow</button>
							-->
						</div>
						<button class="delete-icon" type="button"
							class="relative p-2 focus:outline-none border-none bg-gray-100 rounded-full">
							<i class='bx bx-trash'></i>
						</button>
					</div>
				</div>
				<p class="text-black-500 text-base md:text-lg px-3  leading-snug md:leading-normal capitalize">
					{{post.text}}</p>

				{% if show_detail_link %}
				<div class="relative w-full h-full px-3">
					<a href="{% url 'feed:detail' post.id %}">
						<img src="{{ post.photo.url }}" alt="SocialBook"
							class="rounded w-full h-full object-cover object-scale-down">
					</a>
				</div>
				{% else %}
				<div class="relative w-full h-full px-3">

					<img src="{{ post.photo.url }}" alt="SocialBook"
						class="rounded w-full h-full object-cover object-scale-down">

				</div>

				{% endif %}
				<div class="">

					<!-- Comment -->
					<div class="overflow-y-scroll w-full absolute inset-0 bg-white transform transition duration-200"
						x-show="comment" x-transition:enter="transition ease-out duration-200"
						x-transition:enter-start="opacity-0 transform scale-90"
						x-transition:enter-end="opacity-100 transform scale-100"
						x-transition:leave="transition ease-in duration-100"
						x-transition:leave-start="opacity-100 transform scale-100"
						x-transition:leave-end="opacity-0 transform scale-90">
						<div class="flex justify-start items-center py-2 px-4 border-b" @click="comment = !comment">
							<svg class="w-8 h-8 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"
								xmlns="http://www.w3.org/2000/svg">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
									d="M7 16l-4-4m0 0l4-4m-4 4h18"></path>
							</svg>
						</div>
						<div class="p-2 mb-10">
							<!-- System Comment -->
							<div
								class="flex justify-start flex-col space-y-3 items-start px-2 border-b border-gray-100">
								<div class="relative mt-1 mb-3 pt-2 flex">
									<div class="mr-2">
										<img src="" alt="SocialBook" class="w-8 h-8 rounded-full object-cover">
									</div>
									<div class="ml-2 w-full" x-data="{ replies : false }">
										<p class="text-gray-600 md:text-sm text-xs w-full">
											<!-- Username User -->
											<span class="font-normal text-gray-900">SocialBook</span>
											<!-- Username User -->
											You Can see?
										</p>
										<div class="flex space-x-4">
											<div class="time mt-1 text-gray-400 text-xs">
												<p>2d</p>
											</div>
											<button type="button"
												class="focus:outline-none time mt-1 text-gray-400 text-xs">
												<p>replay</p>
											</button>
										</div>
										<button type="button" @click="replies = !replies"
											class="focus:outline-none  mt-3 flex justify-center items-center">
											<p class="text-xs text-center text-indigo-500 flex space-x-2">
												<span>____ View replies (1)</span> <svg class="w-3 h-4" fill="none"
													stroke="currentColor" viewBox="0 0 24 24"
													xmlns="http://www.w3.org/2000/svg">
													<path stroke-linecap="round" stroke-linejoin="round"
														stroke-width="2" d="M19 9l-7 7-7-7"></path>
												</svg>
											</p>
										</button>
										<div x-show="replies" x-transition
											class="flex justify-start flex-col space-y-3 items-start px-2 border-b border-gray-100">
											<div class="relative mt-1 mb-3 pt-2 flex">
												<div class="mr-2">
													<img src="" alt="SocialBook"
														class="w-8 h-8 rounded-full object-cover">
												</div>
												<div class="ml-2 w-full" x-data="{ replies : true }">
													<p class="text-gray-600 md:text-sm text-xs w-full">
														<!-- Username User -->
														<span class="font-normal text-gray-900">SocialBook</span>
														<!-- Username User -->
														You Can see?
													</p>
													<div class="flex space-x-4">
														<div class="time mt-1 text-gray-400 text-xs">
															<p>2d</p>
														</div>
														<button type="button"
															class="focus:outline-none time mt-1 text-gray-400 text-xs">
															<p>replay</p>
														</button>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>

							<div
								class="flex justify-start flex-col space-y-3 items-start px-2 border-b border-gray-100">
								<div class="relative mt-1 mb-3 pt-2 flex">
									<div class="mr-2">
										<img src="" alt="SocialBook" class="w-8 h-8 rounded-full object-cover">
									</div>
									<div class="ml-2 w-full">
										<p class="text-gray-600 md:text-sm text-xs w-full">
											<!-- Username User -->
											<span class="font-normal text-gray-900">SocialBook</span>
											<!-- Username User -->
											You Can see?
										</p>
										<div class="time mt-1 text-gray-400 text-xs">
											<p>2d</p>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- System Like and tools Feed -->
					<div class="flex justify-between items-start pl-1 py-1 md:pl-4 md:py-2">
						<div class="flex space-x-2 items-center items-baseline">
								<!-- <button class="js-like">Js test</button> -->
								<form action="{% url 'feed:like_post' %}" method="POST" id="{{post.id}}" class="like-form">
									{% csrf_token %}
									<input type="hidden" name='post_id' value="{{post.id}}">
										<div>
											<button id="like-box{{post.id}}" class="like-button{{post.id}} font-bold text-base md:text-2xl
											rounded hover:text-blue-500">
												{% if request.user not in post.likes.all %}
													<i class="bx bx-like"></i>
												{% else %}
													<i class="bx bx-dislike"></i>												
												{% endif %}
											</button>
										</div>
										
										<button type="submit" class="like-button{{post.id}} text-gray-500 text-sm">
													
													{% if request.user not in post.likes.all %}
														Like
													{% else %}
														Dislike													
													{% endif %}
														
										</button>
										<div class="w-full mt-2 h-5 font-bold text-sm text-gray-700 flex">
							

											<div class="like-count{{post.id}} font-bold pr-1">{{post.total_like}}</div><span> Likes</span> 
										</div>
								</form>
					
								<form action="" method="POST" id="{{post.id}}" class="comment-form">
									{% csrf_token %}
									<input type="hidden" name='post_id' value="{{post.id}}">
										<div>
											<button id="comment-box{{post.id}}" class="comment-button{{post.id}} font-bold text-base md:text-2xl
											rounded hover:text-blue-500">
												<i class="bx bx-comment"></i>
												<div class="text-sm text-gray-500">Comment</div>
											</button>
										</div>
								</form>
						
					
						</div>
					</div>
					<div class="flex flex-col pl-1 py-1 md:pl-4 md:py-2">
					
						<div class="w-full h-4 text-end">
							<p class="font-normal text-xs text-gray-500">{{post.date_time | timesince}} ago</p>
						</div>
					</div>
	
					<hr>
					<!-- End System Like and tools Feed -->
					<div class=" pl-1 py-1 md:pl-4">
						
						{% if post.comment_set.all %}
							{% for comment in post.comment_set.all  %}
								<div class="flex">

									<a href="">
										
										{% thumbnail comment.user.image "29x29" crop="center" as im %}
										<img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}"
											class="rounded-full object-scale-down">
										{% endthumbnail %}
							
									</a>
									<!-- <p>{{profile.gender}}</p> -->
									<p class="pl-1 md:pl-3 text-base">{{comment.content}}</p>
							
									<!-- <p class="pl-1 md:pl-3 text-base">{{comment.user.image.url}}</p> -->
								</div>
							{% endfor %}
						{% endif %}
						<!-- {{comment_form.as_p}} -->
							
								
					</div>
					<div class="z-50">
						<form action="" method="POST" class="">
							{% csrf_token %}
							<div class="flex justify-between border-t items-center w-full"
								:class="comment ? 'absolute bottom-0' : '' ">
								<input hidden name="post_id" value="{{post.id}}"> 
								 <div class="w-full ">
									<input type="text" name="content" placeholder="Add a comment here" required="" id="id_content" 
										   class="w-full text-sm py-4 px-3 rounded-none focus:outline-none">
								</div>
								<div class="w-20">
									<button
										class="comment-button{{post.id}} border-none text-sm px-4 bg-white py-4 text-indigo-600 focus:outline-none">Post</button>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
<!-- TODO:Delete form -->
		<div class="min-w-screen animated fadeIn faster  fixed  left-0 top-0 flex justify-center items-center inset-0 z-50 outline-none focus:outline-none bg-no-repeat bg-center bg-cover hidden delete-toggle-form"   id="modal-id">
			<div class="absolute inset-0 z-0  w-24 md:w-48 lg:w-64"></div>
		 <div class="w-full  max-w-xs p-1 relative mx-auto my-auto rounded-xl border bg-white ">
		   <!--content-->
	
		   <form action="" method="POST" id="{{post.id}}" class="delete-form">
			   {% csrf_token %}
			 <!--body-->
			 <input type="hidden" name='post_id' value="{{post.id}}">
				<div class="text-center p-1 flex-auto justify-center">
						<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 -m-1 flex items-center text-red-500 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
						</svg>
						<svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 flex items-center text-red-500 mx-auto" viewBox="0 0 20 20" fill="currentColor">
							<path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
						</svg>
								<h2 class="text-xl font-bold py-1 ">Are you sure?</h3>
								<p class="text-sm text-gray-500 px-8">Do you really want to delete this post?
						This process cannot be undone</p>    
				</div>
				<!--footer-->
				<div class="p-1   text-center space-x-4 md:block">
					<button class="delete-icon mb-2 md:mb-0 bg-white px-5 py-2 text-sm shadow-sm font-medium tracking-wider border text-gray-600 rounded-full hover:shadow-lg hover:bg-gray-100">
						Cancel
					</button>
					<button type="submit" class="deleteConfirm-button{{post.id}} mb-2 md:mb-0 bg-red-500 border border-red-500 px-5 py-2 text-sm shadow-sm font-medium tracking-wider text-white rounded-full hover:shadow-lg hover:bg-red-600">Delete</button>
				</div>
			</form>
		   </div>
		 </div>
	




		<script>
			function myFunction(state){
				const state_value = document.getElementById("state_value")
				if(state == 'like'){
					document.getElementById("like-button").className = "bx bx-like";
				}
			}
			
		</script>