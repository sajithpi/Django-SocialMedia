{% load thumbnail %}
{% load post_tags %}
<script defer src="https://unpkg.com/alpinejs@3.1.1/dist/cdn.min.js"></script>
<style>
	@import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');
	@import url('https://fonts.googleapis.com/css2?family=Varela&display=swap');
	@import url('https://fonts.googleapis.com/css2?family=Karla:wght@200&display=swap');

	* {
		font-family: 'Nunito', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
		direction: ltr;
		font-weight: 500;
	}
</style>

{% include 'includes/background.html' %}

<div class="mx-auto flex justify-center max-w-3xl md:mb-1 mt-1 bg-white rounded-lg items-center relative md:p-0 "
	x-data="{
        comment : false,
    }">

	<div class="h-full relative">
		<div class="py-1 px-2">
			<div class="flex justify-between items-center pt-2">
				<div class="relative mt-1 flex">
					<div class="flex mb-1">
						<a href="{% url 'profiles:detail' post.author.username %}">
							{% thumbnail post.author.profile.image "59x59" crop="center" as im %}
							<img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}"
								class="rounded-full object-scale-down">
							{% endthumbnail %}
						</a>
						<!-- <img class="w-12 h-12 rounded-full" src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"/> -->
						<div class="ml-2 mt-0.5">
							<span
								class="block font-medium text-sm md:text-xl leading-snug text-black dark:text-gray-100 object-scale-down capitalize">{{post.author.username}}</span>
							<span
								class="block text-xs md:text-sm text-gray-500 dark:text-gray-400 font-light leading-snug object-scale-down"">{{post.date_time}}</span>
            </div>
          </div>
				
						<!-- <span class=" text-xs mx-2">â€¢</span>
							<button
								class="text-indigo-500 text-sm capitalize flex justify-start items-start">follow</button>
							-->
						</div>
						<button type="button"
							class="relative p-2 focus:outline-none border-none bg-gray-100 rounded-full">
							<svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"
								xmlns="http://www.w3.org/2000/svg">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z">
								</path>
							</svg>
						</button>
					</div>
				</div>
				<p class="text-black-500 text-base md:text-lg px-3  leading-snug md:leading-normal capitalize">
					{{post.text}}</p>

				{% if show_detail_link %}
				<div class="relative w-full h-full px-3">
					<a href="{% url 'feed:detail' post.id %}">
						<img src="{{ post.photo.url }}" alt="SocialBook"
							class="rounded w-full h-full object-cover object-scale-down">
					</a>
				</div>
				{% else %}
				<div class="relative w-full h-full px-3">

					<img src="{{ post.photo.url }}" alt="SocialBook"
						class="rounded w-full h-full object-cover object-scale-down">

				</div>

				{% endif %}
				<div class="">

					<!-- Comment -->
					<div class="overflow-y-scroll w-full absolute inset-0 bg-white transform transition duration-200"
						x-show="comment" x-transition:enter="transition ease-out duration-200"
						x-transition:enter-start="opacity-0 transform scale-90"
						x-transition:enter-end="opacity-100 transform scale-100"
						x-transition:leave="transition ease-in duration-100"
						x-transition:leave-start="opacity-100 transform scale-100"
						x-transition:leave-end="opacity-0 transform scale-90">
						<div class="flex justify-start items-center py-2 px-4 border-b" @click="comment = !comment">
							<svg class="w-8 h-8 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"
								xmlns="http://www.w3.org/2000/svg">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
									d="M7 16l-4-4m0 0l4-4m-4 4h18"></path>
							</svg>
						</div>
						<div class="p-2 mb-10">
							<!-- System Comment -->
							<div
								class="flex justify-start flex-col space-y-3 items-start px-2 border-b border-gray-100">
								<div class="relative mt-1 mb-3 pt-2 flex">
									<div class="mr-2">
										<img src="" alt="SocialBook" class="w-8 h-8 rounded-full object-cover">
									</div>
									<div class="ml-2 w-full" x-data="{ replies : false }">
										<p class="text-gray-600 md:text-sm text-xs w-full">
											<!-- Username User -->
											<span class="font-normal text-gray-900">SocialBook</span>
											<!-- Username User -->
											You Can see?
										</p>
										<div class="flex space-x-4">
											<div class="time mt-1 text-gray-400 text-xs">
												<p>2d</p>
											</div>
											<button type="button"
												class="focus:outline-none time mt-1 text-gray-400 text-xs">
												<p>replay</p>
											</button>
										</div>
										<button type="button" @click="replies = !replies"
											class="focus:outline-none  mt-3 flex justify-center items-center">
											<p class="text-xs text-center text-indigo-500 flex space-x-2">
												<span>____ View replies (1)</span> <svg class="w-3 h-4" fill="none"
													stroke="currentColor" viewBox="0 0 24 24"
													xmlns="http://www.w3.org/2000/svg">
													<path stroke-linecap="round" stroke-linejoin="round"
														stroke-width="2" d="M19 9l-7 7-7-7"></path>
												</svg>
											</p>
										</button>
										<div x-show="replies" x-transition
											class="flex justify-start flex-col space-y-3 items-start px-2 border-b border-gray-100">
											<div class="relative mt-1 mb-3 pt-2 flex">
												<div class="mr-2">
													<img src="" alt="SocialBook"
														class="w-8 h-8 rounded-full object-cover">
												</div>
												<div class="ml-2 w-full" x-data="{ replies : true }">
													<p class="text-gray-600 md:text-sm text-xs w-full">
														<!-- Username User -->
														<span class="font-normal text-gray-900">SocialBook</span>
														<!-- Username User -->
														You Can see?
													</p>
													<div class="flex space-x-4">
														<div class="time mt-1 text-gray-400 text-xs">
															<p>2d</p>
														</div>
														<button type="button"
															class="focus:outline-none time mt-1 text-gray-400 text-xs">
															<p>replay</p>
														</button>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>

							<div
								class="flex justify-start flex-col space-y-3 items-start px-2 border-b border-gray-100">
								<div class="relative mt-1 mb-3 pt-2 flex">
									<div class="mr-2">
										<img src="" alt="SocialBook" class="w-8 h-8 rounded-full object-cover">
									</div>
									<div class="ml-2 w-full">
										<p class="text-gray-600 md:text-sm text-xs w-full">
											<!-- Username User -->
											<span class="font-normal text-gray-900">SocialBook</span>
											<!-- Username User -->
											You Can see?
										</p>
										<div class="time mt-1 text-gray-400 text-xs">
											<p>2d</p>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- System Like and tools Feed -->
					<div class="flex justify-between items-start p-2 py-">
						<div class="flex space-x-2 items-center">
							<form method="post" action="{% url 'feed:like' post.id %}">
								{% csrf_token %}
								<button  class="text-gray-800 font-bold text-2xl
										rounded hover:text-blue-500  
										py-1 px-3 text-xs inline-flex items-center" name="post_id" type="submit" value="{{post.id}}">
									<!-- {% if liked %}
									<i class='bx bx-dislike'></i>
									{% else %}
									<i class='bx bx-like'></i>
									{% endif %} -->

									{% if post.likes.all %}
										{% for data in post.likes.all %}
											
											{% if request.user == data %}
												{% setvar "Unlike" as action %}
											{% else %}
												{% setvar "Like" as action %}

											{% endif %}
											{% if forloop.last == True %}
											
												{% if action == "Unlike" %}
													
													<i class="bx bx-dislike"></i>
												{% elif action == "Like" %}
													
													<i class="bx bx-like"></i>
												{% endif %}
											{% endif %}		
										{% endfor %}
									{% else %}
										<i class="bx bx-like"></i>
									{% endif %}


								</button>

							</form>
						</button>
							<button type="button" class="focus:outline-none Comment" @click="comment = !comment"><svg
									class="w-8 h-8 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"
									xmlns="http://www.w3.org/2000/svg">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6"
										d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z">
									</path>
								</svg>
							</button>
						
						</div>
						<div class="flex space-x-2 items-center">
							<button type="button" class="focus:outline-none Like"><svg class="w-8 h-8 text-gray-600"
									fill="none" stroke="currentColor" viewBox="0 0 24 24"
									xmlns="http://www.w3.org/2000/svg">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6"
										d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
								</svg></button>
						</div>
					</div>
					<div class="p-2 flex flex-col space-y-3">
						<div class="w-full">
							<!-- {% if total_likes >= 1 %} -->
							<p class="font-bold text-sm text-gray-700 font-bold">
							<!-- {% endif %} -->
	
							
						
								 {% for data in post.likes.all %}
										
									{% if request.user == data %}
										{% setvar "Unlike" as action %}
									{% else %}
										{% setvar "Like" as action %}

									{% endif %}
									<p><b>{{forloop.last}}</b>{{data}}</p>
									{% if forloop.last == True %}
									
										{% if action == "Unlike" %}
											<p>Last item yey{{action}}</p>
											<i class="bx bx-dislike"></i>
										{% elif action == "Like" %}
											<p>yoo{{action}}</p>
											<i class="bx bx-like"></i>
										{% endif %}


									{% endif %}
									
									
								{% endfor %}	
									
								<p >{% show_likes %}</p>

							
					
						<!-- <span id="state_value"></span> -->
							{{post.likes.all.count}} <span>Likes</span></p>
						</div>
						<div class="w-full">
							<!-- Time -->

							<p class="font-normal text-xs text-gray-500">{{post.date_time}}</p>
						</div>
					</div>
					<!-- End System Like and tools Feed -->
					<div class="z-50">
						<form>
							<div class="flex justify-between border-t items-center w-full"
								:class="comment ? 'absolute bottom-0' : '' ">
								<div class="w-full ">
									<input type="text" name="comment" id="comment" placeholder="Add A Comment..."
										class="w-full text-sm py-4 px-3 rounded-none focus:outline-none">
								</div>
								<div class="w-20">
									<button
										class="border-none text-sm px-4 bg-white py-4 text-indigo-600 focus:outline-none">Post</button>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
		<script>
			function myFunction(state){
				const state_value = document.getElementById("state_value")
				if(state == 'like'){
					document.getElementById("like-button").className = "bx bx-like";
				}
			}
		</script>