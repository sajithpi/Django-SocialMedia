{% load thumbnail %}
{% load post_tags %}
{% load static %}
<script defer src="https://unpkg.com/alpinejs@3.1.1/dist/cdn.min.js"></script>
<style>
	@import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');
	@import url('https://fonts.googleapis.com/css2?family=Varela&display=swap');
	@import url('https://fonts.googleapis.com/css2?family=Karla:wght@200&display=swap');

	* {
		font-family: 'Nunito', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
		direction: ltr;
		font-weight: 500;
	}
</style>


	
{% include 'includes/background.html' %}

<div class="mx-auto flex justify-center  md:mb-1 mt-1 bg-white rounded items-center relative  border "
	x-data="{
        comment : false,
    }">
	
	<div class="h-full relative post max-w-3xl">
	
		<div class="py-1 px-2">
			<div class="flex justify-between items-center pt-2">
				<div class="relative mt-1 flex">
					<div class="flex mb-1">
						<div class="w-7 h-7 md:w-14 md:h-14">
							<a href="{% url 'profiles:user_profile' post.author.username %}">
								{% thumbnail post.author.profile.image "51x51" crop="center" as im %}
								<img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}"
									class="rounded-full object-scale-down ">
								{% endthumbnail %}
							</a>
						</div>
						<!-- <img class="w-12 h-12 rounded-full" src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"/> -->
						<div class="self-center ml-0 md:ml-2 mt-0.5">
							<span
								class="text-sm md:text-base text-black dark:text-gray-100 object-scale-down capitalize">{{post.author.username}}</span>
							<!-- <span class="timeblock text-xs text-gray-500 text-gray-400 object-scale-down"><small>{{post.date_time}}</small></span> -->
            			</div>
          			</div>
				</div>
						{% if post.author.username == user.username %}
						<div class=" flex">

								<form action="" method="POST" id="{{post.id}}" class="">
									{% csrf_token %}
									<button id="delete-box{{post.id}}" type="button"
										class="relative p-0 md:p-2 focus:outline-none border-none bg-gray-100 rounded-full">
										<a class="delete-icon" href="{% url 'feed:delete' %}" id="{{post.id}}"">
										<i class='bx bx-trash text-sm md:text-base'></i>
										</a>
								</button>
								<!-- TODO:Delete form -->
			
							</form>
							<button id=" edit-box{{post.id}}" type="button"
											class="relative p-0 md:p-2 mx-1 md:mx-3 focus:outline-none border-none bg-gray-100 rounded-full">
											<a class="update-icon" id="{{post.id}}">
												<i class='bx bxs-edit text-sm md:text-base'></i>
												</a>
							</button>
							<!-- Favourites -->
							<button id=" favourites-box{{post.id}}" type="button"
											class="relative p-0 md:p-2 mr-0 md:mr-3 focus:outline-none border-none bg-gray-100 rounded-full">
											<a class="favorite-icon" id="{{post.id}}" href="{% url 'feed:add_to_favorites' %}">
												<span id="favorite-icon{{post.id}}">
													<i class='bx bx-star text-sm md:text-base'></i>
												</span>
											</a>
							</button>
							
						</div>
						{% endif %}
					</div>
				</div>
		
				{% if show_detail_link %}
				<div class="post-img{{post.id}} relative w-full h-full">
					<a href="{% url 'feed:detail' post.id %}">
						<img id="postImg{{post.id}}" src="{{ post.photo.url }}" alt="SocialBook"
							class="w-full h-full object-cover object-scale-down">
					</a>
				</div>
				{% else %}
				<div class="post-img{{post.id}} relative w-full h-full">
				
					<img src="{{ post.photo.url }}" alt="SocialBook"
						class="w-full h-full object-cover object-scale-down">

				</div>

				{% endif %}
				
				<!-- TODO:Like Comment Buttons -->
				<div class="Like_Comment">
					<div class="mx-3 md:mx-5">
						<!-- System Like and tools Feed -->
						<div class="flex justify-between items-start py-0 md:py-2 h-6 md:h-8 my-1 md:mt-3">
							<div class="flex space-x-2 items-center items-baseline">
								<!-- <button class="js-like">Js test</button> -->
								<form class="mr-1 md:mr-5" action="{% url 'feed:like_post' %}" method="POST" id="{{post.id}}" 
									class="like-form mt-0 md:mt-2" enctype="multipart/form-data">
									{% csrf_token %}
									<input type="hidden" name='post_id' value="{{post.id}}">

									<button class="flex font-bold 
												rounded hover:text-blue-500 text-lg md:text-xl lg:text-3xl" type="submit">
										{% if request.user not in post.likes.all %}
										<!-- <i class="bx bx-like"></i> -->
										<span id="like-box{{post.id}}"><i class='bx bx-heart '></i></span>
										<h6 hidden class="like-button{{post.id}} text-gray-500 text-xs md:text-sm my-0">
											Like</h6>
										{% else %}
										<!-- <i class="bx bx-dislike text-blue-500"></i> -->
										<div id="like-box{{post.id}}"><i class='bx bxs-heart text-red-500'></i></div>
										<h6 hidden class="like-button{{post.id}} text-gray-500 text-xs md:text-sm my-0">
											Dislike</h6>

										{% endif %}
									</button>
		
								</form>
								<!-- Comment Button -->
								<input class="mr-1 md:mr-5" type="hidden" name='post_id' value="{{post.id}}" class="post_id_value">
								<div class="md:pr-0 pr-4">
									<button id="comment-box{{post.id}}" class="comment-button{{post.id}} font-bold text-lg md:text-xl lg:text-3xl
												rounded hover:text-blue-500">
										<a href="{% url 'feed:detail' post.id %}" class="text-black"><span><i
													class='bx bx-comment-dots'></i></span></a>
										<div hidden class="text-xs md:text-sm text-gray-500 ">Comment</div>
										
									</button>
								</div>
								
							</div>
							
							
						</div>
							<!-- TODO:Getting  Number of likes -->
						<div class="Like_Count">
								<div class="like-count{{post.id}} text-xs md:text-base font-bold my-0 md:my-1 ">
									{{post.total_like}} Likes
								</div>
						</div>
						<!-- TODO:Post Text -->
						<div class="flex post-text mr-3 mt-0.5">
							<input type="hidden" class="post{{post.id}}" id="{{post.id}}" value="{{post.id}}">
									<span class="text-black-500 text-xs md:text-base font-bold">
												{{request.user|capfirst}}
									</span>
									<div id="post-text{{post.id}}"
										class="w-24 break-words post-text{{post.id}} text-black-500  ml-1 text-xs md:text-base  capitalize mr-3">
										{{post.text}}
								</div>
						</div>
						<div class="flex flex-col  py-1 md:py-1">
							<p class="font-normal text-xs text-gray-500">{{post.date_time |timesince }} ago</p>
						</div>
					
						<!-- TODO: Comment Section -->
						<div class="z-50 ">
							<input hidden name="post_id" value="{{post.id}}">
							<input hidden id="profile_img{{post.id}}" value="{{user.profile.image.url}}">
							<form action="" method="POST" class="comment-form" id="{{post.id}}"
								data-url="{% url 'feed:comment' %}" enctype='multipart/form-data'>
								{% csrf_token %}

								<div class="flex justify-between border-t items-center w-full border-b border-gray-300"
									:class="comment ? 'absolute bottom-0' : '' ">

									<div class="w-full" >
										<input id="comment-content{{post.id}}" type="text" name="content"
											placeholder="Add a comment here" required_id="id_content"
											class="comment-content{{post.id}} w-full text-xs md:text-sm py-2 px-0.5 md:px-3 rounded-none ">
									</div>
									<div class="w-20">
										<button
											class="comment-button{{post.id}} border-none text-xs md:text-sm px-4 bg-white py-2 text-blue-600 focus:outline-none"
											type="submit">Post</button>
									</div>
								</div>
							</form>
						</div>
					
						<!-- TODO:New Comment Section -->
						<input hidden id="comment_flag" value="{{show_comment_list}}">

						<div id="comment-container{{post.id}}" class=" pl-1  md:pl-4 ">
							<input hidden type="text" value="This is the comment "> 
						</div>
						<!-- End System Like and tools Feed -->
						<!-- TODO: Existing Comments Listing -->
					{% if show_comment_list == True %}
							<div class=" pl-1 py-1 md:pl-4  " id="comment_list{{post.id}}">
								{% if post.comment_set.all %}
									{% for comment in post.comment_set.all reversed %}
									<div id="comment-container{{comment.id}}" class=" pl-1  md:pl-4 ">
										<input hidden type="text" value="This is the comment cona=asdadadsadas">
									</div>
										<div class="flex border-b border-gray-300 items-center comment_list" id="comments-list{{post.id}} ">
											<div class="flex  w-14 h-9 md:h-11 mx-auto justify-center">
												<a class="self-center" href="">
													<!-- {{comment.user.user.username}} -->
													{% thumbnail comment.user.user.profile.image "29x29" crop="center" as im %}
													<img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}"
														class="rounded-full object-scale-down">
													{% endthumbnail %}
	
												</a>
											</div>
											
											
											
											<div class="flex-initial grow w-3/4" >
												
												{% if comment.user.user.username == user.username %}
												<div class="flex pl-1 w-full md:pl-3 text-sm md:text-base w-4/5"><textarea class="flex w-full break-words" type="text" id="comment_content{{comment.id}}" value="{{comment.content}}" aria-rowspan="2">{{comment.content}}</textarea></div>
													
												{% else %}
												<div class="flex pl-1 w-full md:pl-3 text-sm md:text-base break-words">{{comment.content}}</div>
												{% endif %}
													
											</div>
											<div class="flex-initial w-1/4">
												
												{% if comment.user.user.username == user.username %}
													<div class=" flex justify-end">
														<form action="" method="POST" id="{{comment.id}}" class="">
															{% csrf_token %}
															<input hidden type="text" name="comment_user" id="comment_user{{comment.id}}" value="{{comment.user.user.username}}">
															<input hidden type="text" name="comment_user_id" id="comment_user_id{{comment.id}}" value="{{comment.user.user.id}}">
															<input hidden type="text" name="comment_content" id="comment_id{{comment.id}}" value="{{comment.content}}">
															<input type="hidden" name='post_id' value="{{post.id}}" class="post_id_value{{comment.id}}">
															<button id="delete-comment-box{{post.id}}" type="button"
																class="relative p-0 md:p-2 focus:outline-none border-none bg-gray-100 rounded-full">
																<a class="delete-comment-icon" href="{% url 'feed:delete_comment' %}" id="{{comment.id}}"">
																<i class='bx bx-trash'></i>
																</a>
															</button>
														<!-- TODO:Delete form -->
														<button id="edit-comment-box{{comment.id}}" type="button"
																	class="relative p-0 md:p-2 focus:outline-none border-none bg-gray-100 rounded-full">
																	<a class="update-comment-icon" href="{% url 'feed:update_comment' %}" id="{{comment.id}}">
																		<i class='bx bxs-edit'></i>
																		</a>
															</button>
									
														</form>
															
													</div>
												{% endif %}
											</div>






										</div>
										
										
									{% endfor %}
								{% endif %}
								<input hidden id="comment-count{{post.id}}" value="{{post.comment_set.all.count}}">
								{% if post.comment_set.all.count > 1 %}
									<a hidden href="{% url 'feed:detail' post.id%}">View ALl
										<span hidden id="comment_count_body{{post.id}}">{{post.comment_set.all.count}}</span> Comments
									</a>
								{% else %}
								<span hidden id="comment_count_body{{post.id}}">comments</span> Comments
								{% endif %}
							</div>

						<!-- TODO:If show comment list = False -->
					{% else %}
						<div class=" pl-1 md:pl-4 divide-y divide-slate-200">
							{% if post.comment_set.all %}
								{% for comment in post.comment_set.all reversed %}
									{% if forloop.counter < 3 %}
										<div class="flex my-1 " id="comments-list{{post.id}}">
											<div class="text-xs md:text-base font-bold ">{{comment.user.user.username}}</div>
											<div class="pl-1 md:pl-3 text-xs md:text-base self-center">{{comment.content}}</div>
											<span></span>
										</div>
									{% endif %}
								{% endfor %}
								{% if post.comment_set.all.count > 1 %}
									<input  hidden id="comment-count{{post.id}}" value="{{post.comment_set.all.count}}">
										<a class="text-xs md:text-sm text-blue-500 my-3" href="{% url 'feed:detail' post.id%}">View ALl
											<span id="comment_count_body{{post.id}}">{{post.comment_set.all.count}}</span> Comments
										</a>
								{% endif %}
							{% else %}
							<input hidden id="comment-count{{post.id}}" value="1">
							<span  hidden id="comment_count_body{{post.id}}">No Comments</a>
						{% endif %}
						</div>
					{% endif %}
						<input type="hidden" id="refreshed" value="no">
					</div>
				</div>
			</div>
		</div>
		<script>
			function myFunction(state) {
				const state_value = document.getElementById("state_value")
				if (state == 'like') {
					document.getElementById("like-button").className = "bx bx-like";
				}
			}
		</script>