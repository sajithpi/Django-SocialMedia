
{% load thumbnail %}
{% load post_tags %}
{% load static %}
<script defer src="https://unpkg.com/alpinejs@3.1.1/dist/cdn.min.js"></script>
<style>
	@import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');
	@import url('https://fonts.googleapis.com/css2?family=Varela&display=swap');
	@import url('https://fonts.googleapis.com/css2?family=Karla:wght@200&display=swap');

	* {
		font-family: 'Nunito', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
		direction: ltr;
		font-weight: 500;
	}
</style>

{% include 'includes/background.html' %}

<div class="mx-auto flex justify-center max-w-3xl md:mb-1 mt-1 bg-white rounded-lg items-center relative md:p-0 "
	x-data="{
        comment : false,
    }">

	<div class="h-full relative post mx-2 md:mx-3">
		<div class="py-1 px-2">
			<div class="flex justify-between items-center pt-2">
				<div class="relative mt-1 flex">
					<div class="flex mb-1 ">
						<a href="{% url 'profiles:detail' post.author.username %}">
							{% thumbnail post.author.profile.image "59x59" crop="center" as im %}
							<img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}"
								class="rounded-full object-scale-down ">
							{% endthumbnail %}
						</a>
						<!-- <img class="w-12 h-12 rounded-full" src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"/> -->
						<div class="ml-2 mt-0.5">
							<span
								class="block font-medium text-sm md:text-xl leading-snug text-black dark:text-gray-100 object-scale-down capitalize">{{post.author.username}}</span>
							<span
								class="block text-xs md:text-sm text-gray-500 dark:text-gray-400 font-light leading-snug object-scale-down"">{{post.date_time}}</span>
            			</div>
          			</div>
				
						<!-- <span class=" text-xs mx-2">â€¢</span>
							<button
								class="text-indigo-500 text-sm capitalize flex justify-start items-start">follow</button>
							-->
				</div>
						{% if post.author.username == user.username %}
						<div class="flex">

							<form action="" method="POST" id="{{post.id}}" class="">
								{% csrf_token %}
								<button id="delete-box{{post.id}}" type="button" 
									class="relative p-2 focus:outline-none border-none bg-gray-100 rounded-full">
									<a class="delete-icon" href="{% url 'feed:delete' %}" id="{{post.id}}"">
										<i class='bx bx-trash'></i>
									{{post.id}}</a>
								</button>
								<!-- TODO:Delete form -->
			
							</form>
							<button id="edit-box{{post.id}}" type="button" 
							class="relative p-2 mx-3 focus:outline-none border-none bg-gray-100 rounded-full" >
							<a class="update-icon"  id="{{post.id}}">
								<i class='bx bxs-edit'></i>
							{{post.id}}</a>
						</button>
						</div>
						{% endif %}
					</div>
				</div>
				<span class="post-text">
					<input type="hidden" class="post{{post.id}}" id="{{post.id}}" value="{{post.id}}">
					<p id="post-text{{post.id}}" class="post-text{{post.id}} text-black-500 text-base md:text-lg px-3  leading-snug md:leading-normal capitalize">
						{{post.text}}
					</p>
				</span>
				

				{% if show_detail_link %}
				<div class="post-img{{post.id}} relative w-full h-full px-3">
					<a href="{% url 'feed:detail' post.id %}">
						<img id="postImg{{post.id}}" src="{{ post.photo.url }}" alt="SocialBook"
							class="rounded w-full h-full object-cover object-scale-down">
					</a>
				</div>
				{% else %}
				<div class="post-img{{post.id}} relative w-full h-full px-3">

					<img src="{{ post.photo.url }}" alt="SocialBook"
						class=" rounded w-full h-full object-cover object-scale-down">

				</div>

				{% endif %}
				<div class="">

					<!-- Comment -->
					<div class="overflow-y-scroll w-full absolute inset-0 bg-white transform transition duration-200"
						x-show="comment" x-transition:enter="transition ease-out duration-200"
						x-transition:enter-start="opacity-0 transform scale-90"
						x-transition:enter-end="opacity-100 transform scale-100"
						x-transition:leave="transition ease-in duration-100"
						x-transition:leave-start="opacity-100 transform scale-100"
						x-transition:leave-end="opacity-0 transform scale-90">
						<div class="flex justify-start items-center py-2 px-4 border-b" @click="comment = !comment">
							<svg class="w-8 h-8 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"
								xmlns="http://www.w3.org/2000/svg">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
									d="M7 16l-4-4m0 0l4-4m-4 4h18"></path>
							</svg>
						</div>
					
					</div>
				<div class="mx-3 md:mx-5">

				
					<!-- System Like and tools Feed -->
					<div class="flex justify-between items-start pl-1 py-1 md:pl-4 md:py-2">
						<div class="flex space-x-2 items-center items-baseline">
								<!-- <button class="js-like">Js test</button> -->
								<form action="{% url 'feed:like_post' %}" method="POST" id="{{post.id}}" class="like-form">
									{% csrf_token %}
									<input type="hidden" name='post_id' value="{{post.id}}">
										<div>
											<button id="like-box{{post.id}}" class="like-button{{post.id}} font-bold text-lg md:text-2xl
											rounded hover:text-blue-500">
												{% if request.user not in post.likes.all %}
													<!-- <i class="bx bx-like"></i> -->
													<i class='bx bx-heart' ></i>
												{% else %}
													<!-- <i class="bx bx-dislike text-blue-500"></i> -->
													<i class='bx bxs-heart text-blue-500' ></i>											
												{% endif %}
											</button>
										</div>
										
										<button type="submit" class="like-button{{post.id}} text-gray-500 text-xs md:text-sm my-0">
													
													{% if request.user not in post.likes.all %}
														Like
													{% else %}
														Dislike													
													{% endif %}
														
										</button>
										<div class="w-full mt-2 h-5 font-bold text-sm text-gray-700 flex ">
							

											<div class="like-count{{post.id}} text-sm md:text-base font-semibold pr-1 ">{{post.total_like}} Likes</div>
										</div>
								</form>
					
								<form action="" method="POST" id="{{post.id}}" class="comment-form" >
									{% csrf_token %}
									<input type="hidden" name='post_id' value="{{post.id}}">
										<div>
											<button id="comment-box{{post.id}}" class="comment-button{{post.id}} font-bold text-lg md:text-2xl
											rounded hover:text-blue-500">
											<i class='bx bx-comment-dots'></i>
												<div class="text-xs md:text-sm text-gray-500 ">Comment</div>
											</button>
										</div>
								</form>
						
					
						</div>
						<div class="flex flex-col pr-1 py-1 md:pr-4 md:py-1">
					
							<div class="w-full h-4 text-end">
								<p class="font-normal text-xs text-gray-500">{{post.date_time | timesince}} ago</p>
							</div>
						</div>
					</div>
			
					<!-- End System Like and tools Feed -->
				
				{% if show_comment_list == True %}
				<div class=" pl-1 py-1 md:pl-4 mt-1 md:mt-2 ">
						
					{% if post.comment_set.all %}
						<!-- {{post.comment_set.all.count}} -->
						{% for comment in post.comment_set.all  %}
							<div class="flex" id="comments-list{{post.id}}">

								<a href="" >
									
									{% thumbnail comment.user.image "29x29" crop="center" as im %}
									<img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}"
										class="rounded-full object-scale-down" >
									{% endthumbnail %}
						
								</a>
								

								
								<p class="pl-1 md:pl-3 text-xs md:text-base" >{{comment.content}}</p>
								<span ></span>
								
						
							
							</div>
						{% endfor %}
					{% endif %}
				
							
				</div>
				<div  id="comment-container{{post.id}}"class=" pl-1 py-1 md:pl-4 mt-1 md:mt-2 ">
						
				</div>
				<div class="z-50 ">
					<input hidden name="post_id" value="{{post.id}}"> 
					<input hidden id="profile_img{{post.id}}" value="{{profile.image.url}}">
					<form action="" method="POST" class="comment-form" id="{{post.id}}" data-url="{% url 'feed:comment' %}" enctype='multipart/form-data'>
						{% csrf_token %}
					
						<div class="flex justify-between border-t items-center w-full"
							:class="comment ? 'absolute bottom-0' : '' ">
							
							 <div class="w-full ">
								<input id="comment-content{{post.id}}"type="text" name="content" placeholder="Add a comment here" required_id="id_content" 
									   class="comment-content{{post.id}} w-full text-sm py-4 px-3 rounded-none focus:outline-none">
							</div>
							<div class="w-20">
								<button
									class="comment-button{{post.id}} border-none text-sm px-4 bg-white py-4 text-indigo-600 focus:outline-none" type="submit">Post</button>
							</div>
						</div>
					</form>
				</div>
				{% endif %}
					

				<input type="hidden" id="refreshed" value="no"> 
				</div>
			</div>




				
			</div>
		</div>





		<script>
			function myFunction(state){
				const state_value = document.getElementById("state_value")
				if(state == 'like'){
					document.getElementById("like-button").className = "bx bx-like";
				}
			}
		 

		</script>